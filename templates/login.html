{% extends "base.html" %}
{% block title %}{{ t('login') }} - SocialPay{% endblock %}
{% block content %}
<div class="auth-page">
  <div class="auth-hero">
    <div class="auth-logo">Social<span>Pay</span></div>
    <div class="auth-tagline">{{ t('tagline') }}</div>

    <!-- LANGUAGE SELECTOR -->
    <div class="lang-bar" style="margin-top:18px">
      <a href="/set_lang/en" class="lang-btn {{ 'active' if lang == 'en' else '' }}">ğŸ‡¬ğŸ‡§ EN</a>
      <a href="/set_lang/ar" class="lang-btn {{ 'active' if lang == 'ar' else '' }}">ğŸ‡¸ğŸ‡¦ Ø¹Ø±Ø¨ÙŠ</a>
      <a href="/set_lang/ha" class="lang-btn {{ 'active' if lang == 'ha' else '' }}">ğŸ‡³ğŸ‡¬ Hausa</a>
    </div>
  </div>

  <div class="auth-card">
    <!-- TABS -->
    <div class="auth-tabs">
      <button class="auth-tab {{ 'active' if tab != 'register' else '' }}" id="tab-login" onclick="switchTab('login')">{{ t('login') }}</button>
      <button class="auth-tab {{ 'active' if tab == 'register' else '' }}" id="tab-reg" onclick="switchTab('register')">{{ t('register') }}</button>
    </div>

    <!-- LOGIN -->
    <div id="form-login" style="{{ 'display:none' if tab == 'register' else '' }}">
      <div class="form-group">
        <label class="form-label">{{ t('email') }}</label>
        <input type="email" class="form-control" id="l-email" placeholder="example@gmail.com" autocomplete="email">
      </div>
      <div class="form-group">
        <label class="form-label">{{ t('password') }}</label>
        <div class="input-wrap">
          <input type="password" class="form-control" id="l-pw" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" autocomplete="current-password">
          <button class="input-suffix" onclick="togglePw('l-pw',this)">ğŸ‘ï¸</button>
        </div>
      </div>
      <button class="btn btn-primary" id="login-btn" onclick="doLogin()">ğŸš€ {{ t('login_now') }}</button>
      <p style="text-align:center;margin-top:18px;font-size:13px;color:var(--muted)">
        <a href="#" onclick="switchTab('register');return false" style="color:var(--accent);font-weight:700">{{ t('register') }} â†’</a>
      </p>
    </div>

    <!-- REGISTER -->
    <div id="form-reg" style="{{ '' if tab == 'register' else 'display:none' }}">
      <div class="form-group">
        <label class="form-label">{{ t('full_name') }}</label>
        <input type="text" class="form-control" id="r-name" placeholder="John Doe" autocomplete="name">
      </div>
      <div class="form-group">
        <label class="form-label">{{ t('email') }}</label>
        <input type="email" class="form-control" id="r-email" placeholder="example@gmail.com" autocomplete="email"
          value="{{ request.args.get('email','') }}">
      </div>
      <div class="form-group">
        <label class="form-label">{{ t('password') }}</label>
        <div class="input-wrap">
          <input type="password" class="form-control" id="r-pw" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" autocomplete="new-password">
          <button class="input-suffix" onclick="togglePw('r-pw',this)">ğŸ‘ï¸</button>
        </div>
      </div>
      {% if request.args.get('ref') %}
      <div class="alert alert-success">ğŸ You were invited! Referral bonus applies.</div>
      <input type="hidden" id="r-ref" value="{{ request.args.get('ref','') }}">
      {% else %}
      <div class="form-group">
        <label class="form-label">{{ t('referral_code') }}</label>
        <input type="text" class="form-control" id="r-ref" placeholder="SP12345678">
      </div>
      {% endif %}
      <button class="btn btn-primary" id="reg-btn" onclick="doRegister()">âœ¨ {{ t('create_account') }}</button>
      <p style="text-align:center;margin-top:14px;font-size:12px;color:var(--muted)">
        <a href="#" onclick="switchTab('login');return false" style="color:var(--accent);font-weight:700">â† {{ t('login') }}</a>
      </p>
    </div>
  </div>
</div>
{% endblock %}
{% block extra_js %}
<script>
function switchTab(t) {
  document.getElementById('form-login').style.display = t==='login'?'':'none';
  document.getElementById('form-reg').style.display = t==='register'?'':'none';
  document.getElementById('tab-login').classList.toggle('active',t==='login');
  document.getElementById('tab-reg').classList.toggle('active',t==='register');
}

async function doLogin() {
  const email = document.getElementById('l-email').value.trim();
  const pw = document.getElementById('l-pw').value;
  if (!email||!pw){ showToast('{{ t("fill_all_fields") }}','warning'); return; }
  const fd = new FormData();
  fd.append('email',email); fd.append('password',pw);
  await postForm('/login', fd, document.getElementById('login-btn'));
}

async function doRegister() {
  const name = document.getElementById('r-name').value.trim();
  const email = document.getElementById('r-email').value.trim();
  const pw = document.getElementById('r-pw').value;
  const ref = document.getElementById('r-ref')?.value.trim()||'';
  if(!name||!email||!pw){ showToast('{{ t("fill_all_fields") }}','warning'); return; }
  const fd = new FormData();
  fd.append('name',name); fd.append('email',email);
  fd.append('password',pw); fd.append('ref',ref);
  await postForm('/register', fd, document.getElementById('reg-btn'));
}
</script>
{% endblock %}
