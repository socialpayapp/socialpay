<!DOCTYPE html>
<html lang="{{ lang }}" dir="{{ 'rtl' if lang == 'ar' else 'ltr' }}">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="theme-color" content="#0A2463">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <title>{{ t('manage_users') }} - Admin</title>
  <link rel="stylesheet" href="/static/css/style.css">
</head>
<body>
<div class="page-header" style="background:linear-gradient(135deg,#1a0533,#3d0d6b)">
  <a href="/admin" class="back-btn" style="background:rgba(255,255,255,0.15)">â†</a>
  <div class="page-title-wrap"><div class="page-title">ğŸ‘¥ {{ t('manage_users') }}</div><div class="page-subtitle">{{ users|length }} users</div></div>
</div>
<div style="padding:14px 14px 40px;background:#F0F4FF;min-height:calc(100vh - 60px)">
  <form method="get" style="margin-bottom:14px">
    <div class="search-box" style="border-radius:var(--radius-sm)">
      <span>ğŸ”</span>
      <input type="text" name="q" value="{{ q }}" placeholder="Search name, email, ID...">
      <button type="submit" class="copy-btn">Go</button>
    </div>
  </form>
  <!-- CREATE USER BUTTON -->
  <button class="btn btn-primary btn-icon" style="width:100%;margin-bottom:14px" onclick="openModal('addUserModal')">â• Create New User Account</button>

  {% if users %}
  <div class="data-list">
    {% for u in users %}
    <a href="/admin/user/{{ u.id }}" class="list-item">
      <div style="width:44px;height:44px;border-radius:14px;background:{% if u.banned %}#FEE2E2{% else %}linear-gradient(135deg,var(--primary),var(--accent)){% endif %};display:flex;align-items:center;justify-content:center;font-size:20px;color:white">
        {% if u.banned %}ğŸš«{% else %}ğŸ‘¤{% endif %}
      </div>
      <div class="list-info">
        <div class="list-name">{{ u.name }}</div>
        <div class="list-sub">{{ u.id }} â€¢ {{ u.email }}</div>
      </div>
      <div class="list-right">
        <div class="list-val">â‚¦{{ "%.0f"|format(u.naira) }}</div>
        <div class="list-meta">{{ u.completed_tasks }} tasks</div>
      </div>
    </a>
    {% endfor %}
  </div>
  {% else %}
  <div class="empty-state"><div class="empty-icon">ğŸ‘¥</div><div class="empty-title">No users found</div></div>
  {% endif %}
</div>

  <div id="toast-container" class="toast-container"></div>
  <script src="/static/js/app.js"></script>

<!-- ADD USER MODAL -->
<div class="modal-overlay" id="addUserModal">
  <div class="modal">
    <div class="modal-handle"></div>
    <div class="modal-title">â• Create New User</div>
    <div class="form-group"><label class="form-label">Full Name</label><input type="text" class="form-control" id="nu-name" placeholder="e.g. Musa Garba"></div>
    <div class="form-group"><label class="form-label">Email</label><input type="email" class="form-control" id="nu-email" placeholder="user@email.com"></div>
    <div class="form-group"><label class="form-label">Password</label><input type="password" class="form-control" id="nu-pass" placeholder="Min 6 characters"></div>
    <div class="form-group"><label class="form-label">Account Type</label>
      <select class="form-control" id="nu-admin">
        <option value="0">ğŸ‘¤ Regular User</option>
        <option value="1">ğŸ‘‘ Admin</option>
      </select>
    </div>
    <button class="btn btn-primary" id="nu-btn" onclick="createUser()">â• Create Account</button>
    <button class="btn btn-outline" style="margin-top:10px" onclick="closeModal('addUserModal')">Cancel</button>
  </div>
</div>

<script>
async function createUser() {
  const name  = document.getElementById('nu-name').value.trim();
  const email = document.getElementById('nu-email').value.trim();
  const pass  = document.getElementById('nu-pass').value;
  const admin = document.getElementById('nu-admin').value;
  if (!name || !email || !pass) { showToast('Fill all fields', 'warning'); return; }
  const fd = new FormData();
  fd.append('name', name); fd.append('email', email);
  fd.append('password', pass); fd.append('is_admin', admin);
  const r = await postForm('/admin/add_user', fd, document.getElementById('nu-btn'));
  if (r?.success) {
    closeModal('addUserModal');
    setTimeout(() => location.reload(), 1400);
  }
}
</script>
</body>
</html>
